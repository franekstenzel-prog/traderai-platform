{% extends "layout_app.html" %}
{% set page_title = "Dashboard" %}
{% set active = "dashboard" %}

{% block app_top_actions %}
  <a class="btn btn--primary" href="{{ url_for('analyze_page') }}">New analysis</a>
{% endblock %}

{% block app_content %}
  <div class="grid3">
    <div class="card">
      <div class="muted">Plan</div>
      <div class="big">{{ user_plan_label }}</div>
      {% if user_stripe_status and user_plan_label != "Free" %}
        <div class="muted small" style="margin-top:6px">Status: <span class="mono">{{ user_stripe_status }}</span></div>
      {% endif %}
      <div class="muted small" style="margin-top:10px">This product is educational and not investment advice.</div>
    </div>
    <div class="card">
      <div class="muted">Analyses this month</div>
      <div class="big">{{ user['analyses_used'] }}</div>
      {% if remaining is not none %}
        <div class="muted small" style="margin-top:6px">Remaining: <span class="mono">{{ remaining }}</span></div>
      {% else %}
        <div class="muted small" style="margin-top:6px">Unlimited</div>
      {% endif %}
    </div>
    <div class="card">
      <div class="muted">Performance (Journal)</div>
      <div class="big">{{ perf.net_pnl|round(2) if perf else 0 }}{% if perf_currency %} {{ perf_currency }}{% endif %}</div>
      <div class="muted small" style="margin-top:6px">Win rate: <span class="mono">{{ perf.win_rate|round(1) if perf else 0 }}%</span> • Trades: <span class="mono">{{ perf.trades if perf else 0 }}</span></div>
    </div>
  </div>

  <div class="grid2" style="margin-top:16px">
    <div class="card">
      <div class="card__title">Recent analyses</div>
      {% if recent_analyses and recent_analyses|length %}
        <div class="list">
          {% for r in recent_analyses %}
            <a class="list__row" href="{{ url_for('analysis_view', analysis_id=r['id']) }}">
              <span class="mono">{{ r['pair'] }} • {{ r['timeframe'] }}{% if r['mode'] %} • {{ r['mode'] }}{% endif %}</span>
              <span class="muted">{{ r['created_at'][:10] }}</span>
            </a>
          {% endfor %}
        </div>
      {% else %}
        <div class="muted">No analyses yet.</div>
      {% endif %}
    </div>

    <div class="card">
      <div class="card__title">Recent trades</div>
      {% if recent_trades and recent_trades|length %}
        <div class="list">
          {% for t in recent_trades %}
            <div class="list__row">
              <span class="mono">{{ t['symbol'] }} • {{ t['side'] }}{% if t['mode'] %} • {{ t['mode'] }}{% endif %}</span>
              <span class="muted">PnL: <span class="mono">{{ (t['pnl'] or 0)|round(2) }}</span></span>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="muted">No trades logged yet. Use the Journal tab.</div>
      {% endif %}
    </div>
  </div>
{% endblock %}
