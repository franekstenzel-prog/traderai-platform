{% extends "base.html" %}
{% block title %}TraderAI — Analiza{% endblock %}
{% block content %}
<section class="container">
  <div class="breadcrumbs">
    <a class="muted" href="{{ url_for('dashboard') }}">← Dashboard</a>
  </div>

  <div class="card" style="margin-top:12px">
    <div class="card__title">Analiza #{{ row['id'] }}</div>
    <div class="muted">{{ row['created_at'] }}</div>

    <div class="grid2" style="margin-top:14px">
      
<div class="card card--inset">
  <div class="analysis-header">
    <div>
      <div class="mono muted">{{ result.pair }} • {{ result.timeframe }}</div>
      <div class="muted" style="margin-top:6px">{{ result.setup }}</div>
    </div>

    {% set sig = result.signal %}
    <div class="signal-badge
      {% if sig == 'LONG' %} signal-badge--long
      {% elif sig == 'SHORT' %} signal-badge--short
      {% else %} signal-badge--no
      {% endif %}
    ">{{ sig }}</div>
  </div>

  <div class="trade-boxes">
    <div class="trade-box trade-box--entry">
      <div class="trade-box__label">Entry</div>
      <div class="trade-box__value">{{ result.entry or "—" }}</div>
    </div>

    <div class="trade-box trade-box--sl">
      <div class="trade-box__label">Stop-loss</div>
      <div class="trade-box__value">{{ result.stop_loss or "—" }}</div>
    </div>

    <div class="trade-box trade-box--tp">
      <div class="trade-box__label">Take-profit</div>
      <div class="trade-box__value">
        {% if result.take_profit and result.take_profit|length > 0 %}
          {{ result.take_profit|join(" • ") }}
        {% else %}
          —
        {% endif %}
      </div>
    </div>
  </div>

  <div class="grid2" style="margin-top:14px">
    <div>
      <div class="muted">Wielkość pozycji</div>
      <div class="big">{{ result.position_size }}</div>
    </div>
    <div>
      <div class="muted">Pewność</div>
      <div class="big">{{ result.confidence }}%</div>
    </div>
  </div>

  <div style="margin-top:14px">
    <div class="muted">Newsy</div>
    <div class="mono"><strong>{{ result.news.impact }}</strong> — {{ result.news.summary }}</div>
    {% if result.news.headlines and result.news.headlines|length > 0 %}
      <ul class="muted" style="margin:8px 0 0 18px">
        {% for h in result.news.headlines %}
          <li class="muted">{{ h }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>

  <div style="margin-top:14px">
    <div class="muted">Ryzyko / invalidation</div>
    <div class="mono">{{ result.risk }}</div>
    <div class="muted" style="margin-top:8px">{{ result.invalidation }}</div>
  </div>

  {% if result.issues and result.issues|length > 0 %}
    <div style="margin-top:14px">
      <div class="muted">Uwagi</div>
      <ul class="muted" style="margin:8px 0 0 18px">
        {% for it in result.issues %}
          <li class="muted">{{ it }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
</div>

<div class="card card--inset">
        <div class="muted">Wyjaśnienie</div>
        <div style="margin-top:8px; white-space: pre-line">{{ result.explanation }}</div>

        <div class="muted" style="margin-top:14px">Podgląd screena</div>
        <img class="img-preview" src="data:{{ row['image_mime'] }};base64,{{ row['image_b64'] }}" alt="Wgrany screen" />
      </div>
    </div>

    <div class="muted" style="margin-top:10px">
      Uwaga: To narzędzie ma charakter edukacyjny i nie stanowi porady inwestycyjnej.
    </div>
  </div>
</section>
{% endblock %}
